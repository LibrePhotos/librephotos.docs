"use strict";(self.webpackChunklibrephotos_docs=self.webpackChunklibrephotos_docs||[]).push([[4335],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),h=o,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||r;return n?i.createElement(m,a(a({ref:t},c),{},{components:n})):i.createElement(m,a({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,a=new Array(r);a[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:o,a[1]=s;for(var p=2;p<r;p++)a[p]=n[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8037:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var i=n(7462),o=(n(7294),n(3905));const r={title:"\u2753 FAQ",excerpt:"Scan always fails after importing few images",sidebar_position:7},a=void 0,s={unversionedId:"user-guide/faq",id:"user-guide/faq",title:"\u2753 FAQ",description:"Proxmox - Scan always fails after importing few images",source:"@site/docs/user-guide/faq.md",sourceDirName:"user-guide",slug:"/user-guide/faq",permalink:"/docs/user-guide/faq",draft:!1,editUrl:"https://github.com/LibrePhotos/librephotos.docs/tree/master/docs/user-guide/faq.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"\u2753 FAQ",excerpt:"Scan always fails after importing few images",sidebar_position:7},sidebar:"userguide",previous:{title:"\ud83d\udcdd Image Captioning",permalink:"/docs/user-guide/image-captioning"},next:{title:"\ud83d\udcc2 Missing Photos",permalink:"/docs/user-guide/missing-photos"}},l={},p=[{value:"Proxmox - Scan always fails after importing few images",id:"proxmox---scan-always-fails-after-importing-few-images",level:2},{value:"Symptom",id:"symptom",level:3},{value:"Solution:",id:"solution",level:3},{value:"Steps for Proxmox 6.4:",id:"steps-for-proxmox-64",level:3},{value:"error decoding &#39;Volumes0&#39;: invalid spec: :/data: empty section between colons / &quot;The &quot;scanDirectory&quot; variable is not set. Defaulting to a blank string.&quot;",id:"error-decoding-volumes0-invalid-spec-data-empty-section-between-colons--the-scandirectory-variable-is-not-set-defaulting-to-a-blank-string",level:2},{value:"Why is the scan directory not mounted read-only?",id:"why-is-the-scan-directory-not-mounted-read-only",level:2},{value:"Videos are not playing and showing a 404 error",id:"videos-are-not-playing-and-showing-a-404-error",level:2},{value:"Reason 1:",id:"reason-1",level:3},{value:"Reason 2:",id:"reason-2",level:3}],c={toc:p},u="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"proxmox---scan-always-fails-after-importing-few-images"},"Proxmox - Scan always fails after importing few images"),(0,o.kt)("h3",{id:"symptom"},"Symptom"),(0,o.kt)("p",null,"You get errors like these and you use Proxmox:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'Thread 0x00007fc8dcf3f640 (most recent call first):\n  File "/usr/lib/python3.9/threading.py", line 316 in wait\n  File "/usr/lib/python3.9/threading.py", line 574 in wait\n  File "/usr/local/lib/python3.9/dist-packages/tqdm/_monitor.py", line 59 in run\n  File "/usr/lib/python3.9/threading.py", line 954 in _bootstrap_inner\n  File "/usr/lib/python3.9/threading.py", line 912 in _bootstrap\n\nCurrent thread 0x00007fc998cf8640 (most recent call first):\n  File "/usr/local/lib/python3.9/dist-packages/face_recognition/api.py", line 162 in <listcomp>\n  File "/usr/local/lib/python3.9/dist-packages/face_recognition/api.py", line 162 in _raw_face_landmarks\n  File "/usr/local/lib/python3.9/dist-packages/face_recognition/api.py", line 209 in face_encodings\n  File "/code/api/models/photo.py", line 507 in _extract_faces\n  File "/code/api/directory_watcher.py", line 168 in handle_new_image\n  File "/code/api/directory_watcher.py", line 261 in photo_scanner\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 51 in starmapstar\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 125 in worker\n  File "/usr/lib/python3.9/multiprocessing/process.py", line 108 in run\n  File "/usr/lib/python3.9/multiprocessing/process.py", line 315 in _bootstrap\n  File "/usr/lib/python3.9/multiprocessing/popen_fork.py", line 71 in _launch\n  File "/usr/lib/python3.9/multiprocessing/popen_fork.py", line 19 in __init__\n  File "/usr/lib/python3.9/multiprocessing/context.py", line 277 in _Popen\n  File "/usr/lib/python3.9/multiprocessing/process.py", line 121 in start\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 326 in _repopulate_pool_static\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 337 in _maintain_pool\n  File "/usr/lib/python3.9/multiprocessing/pool.py", line 513 in _handle_workers\n  File "/usr/lib/python3.9/threading.py", line 892 in run\n  File "/usr/lib/python3.9/threading.py", line 954 in _bootstrap_inner\n  File "/usr/lib/python3.9/threading.py", line 912 in _bootstrap\n')),(0,o.kt)("h3",{id:"solution"},"Solution:"),(0,o.kt)("p",null,"This is a problem with proxmox, More specifically with the way the CPU was emulated. By default, QEMU in Proxmox uses its own CPU type kvm64, which has a reduced CPU flags set, to guaranteed that it works everywhere. This means that necessary flags like SSE and AVX are absent, which causes the Fatal Python error: Illegal instruction error."),(0,o.kt)("p",null,"To fix this, one must either manually edit the .conf file and add the flags needed to the kvm64 CPU type, or pick a different method of CPU emulation."),(0,o.kt)("p",null,"To add the flags, edit the xxx.conf file located in /etc/pve/qemu-server/ where xxx is the ID of the VM. The manual can be found here: ",(0,o.kt)("a",{parentName:"p",href:"https://pve.proxmox.com/wiki/Manual:_qm.conf"},"https://pve.proxmox.com/wiki/Manual:_qm.conf")),(0,o.kt)("p",null,"If you don't care about live migration and moving VMs between nodes, the much easier option is to just change the CPU type to Host. With the Host option, the VM will match the CPU type of the host machine."),(0,o.kt)("h3",{id:"steps-for-proxmox-64"},"Steps for Proxmox 6.4:"),(0,o.kt)("p",null,'Select your VM and then Hardware tab.\n{% include figure image_path="/assets/images/135711616-14903f44-2bdc-4830-82e9-a29562f75762.png" alt="Select your VM and then Hardware tab" %}\nThen double-click on Processors or select it and click Edit:\n{% include figure image_path="/assets/images/135711657-3cdc2600-2368-440c-af75-00313c8c8997.png" alt="Then double-click on Processors or select it and click Edit"  %}'),(0,o.kt)("h2",{id:"error-decoding-volumes0-invalid-spec-data-empty-section-between-colons--the-scandirectory-variable-is-not-set-defaulting-to-a-blank-string"},"error decoding 'Volumes","[0]",'\': invalid spec: :/data: empty section between colons / "The "scanDirectory" variable is not set. Defaulting to a blank string."'),(0,o.kt)("p",null,"This error usually means, that you forgot to rename the librephotos.env to .env"),(0,o.kt)("h2",{id:"why-is-the-scan-directory-not-mounted-read-only"},"Why is the scan directory not mounted read-only?"),(0,o.kt)("p",null,"You can set the scan directory as read-only, but then a couple of features will not be available. List of impacted features are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Writing back metadata to media files"),(0,o.kt)("li",{parentName:"ul"},"Uploading images"),(0,o.kt)("li",{parentName:"ul"},"Deleting images")),(0,o.kt)("p",null,"This is not yet handled gracefully, which means, you will probably just get non-descriptive errors, when you are trying to use these features."),(0,o.kt)("h2",{id:"videos-are-not-playing-and-showing-a-404-error"},"Videos are not playing and showing a 404 error"),(0,o.kt)("h3",{id:"reason-1"},"Reason 1:"),(0,o.kt)("p",null,'The video may be encoded in h.265 format, which is not supported by your browser. You can enable "Always transcode videos" under Experimental Settings to resolve this issue. On the other hand, this will be quite CPU heavy.'),(0,o.kt)("h3",{id:"reason-2"},"Reason 2:"),(0,o.kt)("p",null,"The issue could be caused by incorrect file permissions. You can resolve this by adjusting the permissions using the following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"find . -type d -exec chmod 755 {} +\nfind . -type f -exec chmod 644 {} +\n")),(0,o.kt)("p",null,"These commands will ensure that directories have permissions set to 755 and files have permissions set to 644, which should resolve any permission-related issues causing the 404 error."))}d.isMDXComponent=!0}}]);